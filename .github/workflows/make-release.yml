name: Make Release

on:
  push:
    tags:
      - "v*"

jobs:
  tagged-release:
    name: "Tagged Release"
    runs-on: "windows-latest"
    env:
      version: processing-3.5.4

    steps:
      - uses: actions/checkout@v2
      - name: Setup Processing
        uses: carlosperate/download-file-action@v1.0.3
        with:
          file-url: https://download.processing.org/${{ env.version }}-windows64.zip
      - run: 7z x -y .\${{ env.version }}-windows64.zip

      - name: Run Build
        run: |
          ${{ github.workspace }}\${{ env.version }}\processing-java.exe --sketch="${{ github.workspace }}" --output="${{ github.workspace }}\build" --export --platform 'windows'

      - uses: "marvinpinto/action-automatic-releases@latest"
        with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          prerelease: false
          files: |
            build
